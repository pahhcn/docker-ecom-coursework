# Docker ç”µå•†æ•°æ®ç®¡ç†ç³»ç»Ÿ

<div align="center">

![Docker](https://img.shields.io/badge/Docker-20.10+-2496ED?style=for-the-badge&logo=docker&logoColor=white)
![Kubernetes](https://img.shields.io/badge/Kubernetes-1.28+-326CE5?style=for-the-badge&logo=kubernetes&logoColor=white)
![Jenkins](https://img.shields.io/badge/Jenkins-2.4+-D24939?style=for-the-badge&logo=jenkins&logoColor=white)
![Spring Boot](https://img.shields.io/badge/Spring%20Boot-3.2-6DB33F?style=for-the-badge&logo=springboot&logoColor=white)
![Java](https://img.shields.io/badge/Java-17-007396?style=for-the-badge&logo=openjdk&logoColor=white)
![MySQL](https://img.shields.io/badge/MySQL-8.0-4479A1?style=for-the-badge&logo=mysql&logoColor=white)

**ä¸€ä¸ªç”Ÿäº§çº§çš„å®¹å™¨åŒ–ç”µå•†åº”ç”¨ï¼Œå±•ç¤ºç°ä»£ DevOps æœ€ä½³å®è·µ**

[å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹) â€¢ [æ¶æ„è®¾è®¡](#ç³»ç»Ÿæ¶æ„) â€¢ [CI/CD](#jenkins-cicd-pipeline) â€¢ [æ–‡æ¡£](#æ–‡æ¡£)

</div>

---

## ğŸ“‹ ç›®å½•

- [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
- [æ ¸å¿ƒç‰¹æ€§](#æ ¸å¿ƒç‰¹æ€§)
- [ç³»ç»Ÿæ¶æ„](#ç³»ç»Ÿæ¶æ„)
- [æŠ€æœ¯æ ˆ](#æŠ€æœ¯æ ˆ)
- [å‰ç½®è¦æ±‚](#å‰ç½®è¦æ±‚)
- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [é¡¹ç›®ç»“æ„](#é¡¹ç›®ç»“æ„)
- [Docker é•œåƒä¼˜åŒ–](#docker-é•œåƒä¼˜åŒ–)
- [Jenkins CI/CD Pipeline](#jenkins-cicd-pipeline)
- [Kubernetes è“ç»¿éƒ¨ç½²](#kubernetes-è“ç»¿éƒ¨ç½²)
- [API æ–‡æ¡£](#api-ç«¯ç‚¹)
- [æµ‹è¯•](#æµ‹è¯•)
- [ç›‘æ§ç³»ç»Ÿ](#ç›‘æ§)
- [å¸¸ç”¨å‘½ä»¤](#å¸¸ç”¨å‘½ä»¤)
- [æ•…éšœæ’æŸ¥](#æ•…éšœæ’æŸ¥)
- [å®‰å…¨æ³¨æ„äº‹é¡¹](#å®‰å…¨æ³¨æ„äº‹é¡¹)
- [æ–‡æ¡£](#æ–‡æ¡£)
- [è´¡çŒ®æŒ‡å—](#è´¡çŒ®)

---

## é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ª**å®Œæ•´çš„å®¹å™¨åŒ–ç”µå•†æ•°æ®ç®¡ç†ç³»ç»Ÿ**ï¼Œå®ç°äº†ä»å¼€å‘åˆ°ç”Ÿäº§çš„å…¨æµç¨‹ DevOps å®è·µã€‚é¡¹ç›®é‡‡ç”¨ä¸‰å±‚æ¶æ„è®¾è®¡ï¼ŒåŒ…å«å‰ç«¯å±•ç¤ºã€åç«¯ API å’Œæ•°æ®åº“æœåŠ¡ï¼Œé€šè¿‡ Docker å®¹å™¨åŒ–éƒ¨ç½²ï¼Œä½¿ç”¨ Kubernetes è¿›è¡Œç¼–æ’ï¼Œå¹¶é€šè¿‡ Jenkins å®ç°è‡ªåŠ¨åŒ– CI/CD æµæ°´çº¿ã€‚

### ğŸ¯ é¡¹ç›®ç›®æ ‡

- âœ… å±•ç¤º Docker å®¹å™¨åŒ–æœ€ä½³å®è·µ
- âœ… å®ç° Kubernetes ç”Ÿäº§çº§éƒ¨ç½²
- âœ… æ„å»ºå®Œæ•´çš„ CI/CD è‡ªåŠ¨åŒ–æµæ°´çº¿
- âœ… å®ç°é›¶åœæœºè“ç»¿éƒ¨ç½²
- âœ… é›†æˆ APM ç›‘æ§ç³»ç»Ÿ
- âœ… è¾¾åˆ° 80%+ ä»£ç æµ‹è¯•è¦†ç›–ç‡

### ğŸ“Š é¡¹ç›®æˆæœ

| æŒ‡æ ‡ | ç›®æ ‡ | å®é™… | çŠ¶æ€ |
|------|------|------|------|
| é•œåƒå¤§å° | < 500MB | < 200MB | âœ… è¶…é¢å®Œæˆ |
| ä»£ç è¦†ç›–ç‡ | â‰¥ 80% | 85% | âœ… è¾¾æ ‡ |
| æ„å»ºæ—¶é—´ | < 10åˆ†é’Ÿ | ~5åˆ†é’Ÿ | âœ… ä¼˜ç§€ |
| éƒ¨ç½²æ–¹å¼ | è“ç»¿éƒ¨ç½² | å·²å®ç° | âœ… å®Œæˆ |
| ç›‘æ§ç³»ç»Ÿ | Prometheus | å·²éƒ¨ç½² | âœ… å®Œæˆ |

---

## æ ¸å¿ƒç‰¹æ€§

### ğŸ³ å®¹å™¨åŒ–æ¶æ„
- **å¤šé˜¶æ®µæ„å»º**: åç«¯é•œåƒä» 800MB ä¼˜åŒ–åˆ° < 200MB
- **å¥åº·æ£€æŸ¥**: æ‰€æœ‰æœåŠ¡é…ç½®å®Œå–„çš„å¥åº·æ£€æŸ¥æœºåˆ¶
- **é root è¿è¡Œ**: æå‡å®¹å™¨å®‰å…¨æ€§
- **å±‚ç¼“å­˜ä¼˜åŒ–**: åŠ é€Ÿé•œåƒæ„å»ºè¿‡ç¨‹

### â˜¸ï¸ Kubernetes ç¼–æ’
- **è“ç»¿éƒ¨ç½²**: å®ç°é›¶åœæœºæ›´æ–°
- **è‡ªåŠ¨æ‰©ç¼©å®¹**: æ”¯æŒ HPA æ°´å¹³æ‰©å±•
- **æœåŠ¡å‘ç°**: é€šè¿‡ Service å®ç°æœåŠ¡é—´é€šä¿¡
- **é…ç½®ç®¡ç†**: ConfigMap å’Œ Secret åˆ†ç¦»é…ç½®

### ğŸ”„ CI/CD è‡ªåŠ¨åŒ–
- **è‡ªåŠ¨è§¦å‘**: ä»£ç æäº¤è‡ªåŠ¨è§¦å‘æ„å»º
- **å®Œæ•´æµæ°´çº¿**: æ„å»º â†’ æµ‹è¯• â†’ éƒ¨ç½² â†’ éªŒè¯
- **å‚æ•°åŒ–æ„å»º**: çµæ´»çš„éƒ¨ç½²ç­–ç•¥é€‰æ‹©
- **å¤±è´¥å›æ»š**: è‡ªåŠ¨ä¿æŒç¨³å®šç‰ˆæœ¬

### ğŸ“Š ç›‘æ§å‘Šè­¦
- **Prometheus**: å®æ—¶æŒ‡æ ‡é‡‡é›†
- **Grafana**: å¯è§†åŒ–ç›‘æ§ä»ªè¡¨æ¿
- **Alertmanager**: æ™ºèƒ½å‘Šè­¦é€šçŸ¥
- **Spring Actuator**: åº”ç”¨å¥åº·æ£€æŸ¥

### ğŸ§ª æµ‹è¯•ä½“ç³»
- **å•å…ƒæµ‹è¯•**: JUnit 5 æµ‹è¯•æ¡†æ¶
- **å±æ€§æµ‹è¯•**: jqwik éšæœºæµ‹è¯•ï¼ˆ100+ æ¬¡è¿­ä»£ï¼‰
- **é›†æˆæµ‹è¯•**: TestContainers å®¹å™¨åŒ–æµ‹è¯•
- **è¦†ç›–ç‡æŠ¥å‘Š**: JaCoCo è‡ªåŠ¨ç”ŸæˆæŠ¥å‘Š

---

## ç³»ç»Ÿæ¶æ„

### ä¸‰å±‚æ¶æ„è®¾è®¡

ç³»ç»Ÿé‡‡ç”¨ç»å…¸çš„ä¸‰å±‚æ¶æ„ï¼Œæ¯å±‚ç‹¬ç«‹éƒ¨ç½²å’Œæ‰©å±•ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ç”¨æˆ·è®¿é—®å±‚                                    â”‚
â”‚                    http://localhost:8082                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Kubernetes é›†ç¾¤ (Minikube)                        â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              å‘½åç©ºé—´: ecommerce                             â”‚   â”‚
â”‚  â”‚                                                               â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”â”‚   â”‚
â”‚  â”‚  â”‚   å‰ç«¯æœåŠ¡      â”‚      â”‚   åç«¯æœåŠ¡      â”‚      â”‚ æ•°æ® â”‚â”‚   â”‚
â”‚  â”‚  â”‚   (Nginx)       â”‚â”€â”€â”€â”€â”€>â”‚ (Spring Boot)   â”‚â”€â”€â”€â”€â”€>â”‚ åº“   â”‚â”‚   â”‚
â”‚  â”‚  â”‚                 â”‚      â”‚                 â”‚      â”‚MySQL â”‚â”‚   â”‚
â”‚  â”‚  â”‚ Blue:  2 å‰¯æœ¬   â”‚      â”‚ Blue:  2 å‰¯æœ¬   â”‚      â”‚      â”‚â”‚   â”‚
â”‚  â”‚  â”‚ Green: 2 å‰¯æœ¬   â”‚      â”‚ Green: 2 å‰¯æœ¬   â”‚      â”‚1 å‰¯æœ¬â”‚â”‚   â”‚
â”‚  â”‚  â”‚                 â”‚      â”‚                 â”‚      â”‚      â”‚â”‚   â”‚
â”‚  â”‚  â”‚ Port: 80        â”‚      â”‚ Port: 8080      â”‚      â”‚3306  â”‚â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”˜â”‚   â”‚
â”‚  â”‚                                                               â”‚   â”‚
â”‚  â”‚  Service é€šè¿‡ selector æ§åˆ¶æµé‡æŒ‡å‘ Blue æˆ– Green           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              å‘½åç©ºé—´: monitoring                            â”‚   â”‚
â”‚  â”‚                                                               â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚   â”‚
â”‚  â”‚  â”‚ Prometheus   â”‚  â”‚   Grafana    â”‚  â”‚ Alertmanager â”‚      â”‚   â”‚
â”‚  â”‚  â”‚ æŒ‡æ ‡é‡‡é›†     â”‚  â”‚ å¯è§†åŒ–ä»ªè¡¨æ¿ â”‚  â”‚  å‘Šè­¦ç®¡ç†    â”‚      â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æœåŠ¡è¯´æ˜

#### 1. å‰ç«¯æœåŠ¡ (Frontend)
- **æŠ€æœ¯æ ˆ**: Nginx Alpine + HTML/CSS/JavaScript
- **åŠŸèƒ½**: æä¾›äº§å“åˆ—è¡¨å’Œè¯¦æƒ…é¡µé¢å±•ç¤º
- **ç‰¹æ€§**: 
  - åå‘ä»£ç†åˆ°åç«¯ API
  - Gzip å‹ç¼©ä¼˜åŒ–ä¼ è¾“
  - é™æ€èµ„æºç¼“å­˜
  - å¥åº·æ£€æŸ¥ç«¯ç‚¹

#### 2. åç«¯æœåŠ¡ (Backend)
- **æŠ€æœ¯æ ˆ**: Spring Boot 3.2 + Java 17
- **åŠŸèƒ½**: RESTful APIï¼Œæä¾›å®Œæ•´çš„ CRUD æ“ä½œ
- **ç‰¹æ€§**:
  - JPA æ•°æ®æŒä¹…åŒ–
  - å‚æ•°éªŒè¯
  - å¼‚å¸¸å¤„ç†
  - Actuator å¥åº·æ£€æŸ¥
  - Prometheus æŒ‡æ ‡æš´éœ²

#### 3. æ•°æ®åº“æœåŠ¡ (Database)
- **æŠ€æœ¯æ ˆ**: MySQL 8.0
- **åŠŸèƒ½**: äº§å“æ•°æ®æŒä¹…åŒ–å­˜å‚¨
- **ç‰¹æ€§**:
  - UTF-8 å­—ç¬¦é›†æ”¯æŒ
  - è‡ªåŠ¨åˆå§‹åŒ–è„šæœ¬
  - æ•°æ®å·æŒä¹…åŒ–
  - è¿æ¥æ± ä¼˜åŒ–

### æ•°æ®æµå‘

```
ç”¨æˆ·è¯·æ±‚ â†’ Nginx (å‰ç«¯) â†’ Spring Boot (åç«¯) â†’ MySQL (æ•°æ®åº“)
         â†“                  â†“                    â†“
    é™æ€é¡µé¢å±•ç¤º        ä¸šåŠ¡é€»è¾‘å¤„ç†          æ•°æ®æŒä¹…åŒ–
```

---

## æŠ€æœ¯æ ˆ

### åº”ç”¨å±‚
| ç»„ä»¶ | æŠ€æœ¯ | ç‰ˆæœ¬ | è¯´æ˜ |
|------|------|------|------|
| å‰ç«¯ | Nginx Alpine | latest | è½»é‡çº§ Web æœåŠ¡å™¨ |
| å‰ç«¯æ¡†æ¶ | HTML5/CSS3/JavaScript | - | åŸç”Ÿ Web æŠ€æœ¯ |
| åç«¯ | Spring Boot | 3.2.0 | Java ä¼ä¸šçº§æ¡†æ¶ |
| ç¼–ç¨‹è¯­è¨€ | Java | 17 | LTS é•¿æœŸæ”¯æŒç‰ˆæœ¬ |
| æ„å»ºå·¥å…· | Maven | 3.9 | ä¾èµ–ç®¡ç†å’Œæ„å»º |
| æ•°æ®åº“ | MySQL | 8.0 | å…³ç³»å‹æ•°æ®åº“ |
| ORM | Spring Data JPA | 3.2.0 | å¯¹è±¡å…³ç³»æ˜ å°„ |

### å®¹å™¨åŒ–ä¸ç¼–æ’
| ç»„ä»¶ | æŠ€æœ¯ | ç‰ˆæœ¬ | è¯´æ˜ |
|------|------|------|------|
| å®¹å™¨å¼•æ“ | Docker | 20.10+ | å®¹å™¨åŒ–å¹³å° |
| ç¼–æ’å·¥å…· | Docker Compose | 2.x | æœ¬åœ°å¼€å‘ç¼–æ’ |
| å®¹å™¨ç¼–æ’ | Kubernetes | 1.28+ | ç”Ÿäº§ç¯å¢ƒç¼–æ’ |
| K8s ç¯å¢ƒ | Minikube | 1.28+ | æœ¬åœ° K8s é›†ç¾¤ |

### CI/CD
| ç»„ä»¶ | æŠ€æœ¯ | ç‰ˆæœ¬ | è¯´æ˜ |
|------|------|------|------|
| CI/CD å¹³å° | Jenkins | 2.4+ | è‡ªåŠ¨åŒ–æµæ°´çº¿ |
| ç‰ˆæœ¬æ§åˆ¶ | Git | 2.x | ä»£ç ç‰ˆæœ¬ç®¡ç† |
| ä»£ç æ‰˜ç®¡ | GitHub | - | è¿œç¨‹ä»“åº“ |
| é•œåƒä»“åº“ | Docker Registry | 2.x | æœ¬åœ°é•œåƒä»“åº“ |

### ç›‘æ§ä¸æ—¥å¿—
| ç»„ä»¶ | æŠ€æœ¯ | ç‰ˆæœ¬ | è¯´æ˜ |
|------|------|------|------|
| æŒ‡æ ‡é‡‡é›† | Prometheus | latest | æ—¶åºæ•°æ®åº“ |
| å¯è§†åŒ– | Grafana | latest | ç›‘æ§ä»ªè¡¨æ¿ |
| å‘Šè­¦ | Alertmanager | latest | å‘Šè­¦ç®¡ç† |
| åº”ç”¨ç›‘æ§ | Spring Actuator | 3.2.0 | å¥åº·æ£€æŸ¥å’ŒæŒ‡æ ‡ |
| æŒ‡æ ‡æ ¼å¼ | Micrometer | latest | æŒ‡æ ‡æ”¶é›†åº“ |

### æµ‹è¯•
| ç»„ä»¶ | æŠ€æœ¯ | ç‰ˆæœ¬ | è¯´æ˜ |
|------|------|------|------|
| å•å…ƒæµ‹è¯• | JUnit 5 | 5.10+ | æµ‹è¯•æ¡†æ¶ |
| å±æ€§æµ‹è¯• | jqwik | 1.8.2 | åŸºäºå±æ€§çš„æµ‹è¯• |
| é›†æˆæµ‹è¯• | TestContainers | 1.19.3 | å®¹å™¨åŒ–æµ‹è¯• |
| è¦†ç›–ç‡ | JaCoCo | 0.8.11 | ä»£ç è¦†ç›–ç‡åˆ†æ |
| Mock æ¡†æ¶ | Mockito | 5.x | å¯¹è±¡æ¨¡æ‹Ÿ |

---

## å‰ç½®è¦æ±‚

### å¿…éœ€è½¯ä»¶

| è½¯ä»¶ | æœ€ä½ç‰ˆæœ¬ | æ¨èç‰ˆæœ¬ | å®‰è£…æŒ‡å— |
|------|---------|---------|---------|
| Docker | 20.10 | 24.0+ | [å®˜æ–¹æ–‡æ¡£](https://docs.docker.com/get-docker/) |
| Docker Compose | 2.0 | 2.20+ | éš Docker Desktop å®‰è£… |
| Minikube | 1.28 | 1.32+ | [å®˜æ–¹æ–‡æ¡£](https://minikube.sigs.k8s.io/docs/start/) |
| kubectl | 1.28 | 1.29+ | [å®˜æ–¹æ–‡æ¡£](https://kubernetes.io/docs/tasks/tools/) |
| Java | 17 | 17 LTS | [OpenJDK](https://openjdk.org/) |
| Maven | 3.9 | 3.9+ | [å®˜æ–¹æ–‡æ¡£](https://maven.apache.org/install.html) |
| Git | 2.0 | 2.40+ | [å®˜æ–¹æ–‡æ¡£](https://git-scm.com/downloads) |

### ç³»ç»Ÿè¦æ±‚

- **æ“ä½œç³»ç»Ÿ**: Linux / macOS / Windows 10+
- **CPU**: 4 æ ¸å¿ƒä»¥ä¸Š
- **å†…å­˜**: 8GB ä»¥ä¸Šï¼ˆæ¨è 16GBï¼‰
- **ç£ç›˜ç©ºé—´**: 20GB å¯ç”¨ç©ºé—´
- **ç½‘ç»œ**: ç¨³å®šçš„äº’è”ç½‘è¿æ¥ï¼ˆç”¨äºæ‹‰å–é•œåƒï¼‰

### éªŒè¯å®‰è£…

```bash
# éªŒè¯ Docker
docker --version
docker-compose --version

# éªŒè¯ Kubernetes
minikube version
kubectl version --client

# éªŒè¯ Java å’Œ Maven
java -version
mvn -version

# éªŒè¯ Git
git --version
```

---

## å¿«é€Ÿå¼€å§‹

### æ–¹å¼ä¸€: Docker Compose (æ¨èç”¨äºæœ¬åœ°å¼€å‘)

è¿™æ˜¯æœ€å¿«é€Ÿçš„å¯åŠ¨æ–¹å¼ï¼Œé€‚åˆæœ¬åœ°å¼€å‘å’Œæµ‹è¯•ã€‚

```bash
# 1. å…‹éš†ä»“åº“
git clone https://github.com/pahhcn/docker-ecom-coursework.git
cd docker-ecom-coursework

# 2. å¯åŠ¨æ‰€æœ‰æœåŠ¡ï¼ˆé¦–æ¬¡å¯åŠ¨ä¼šè‡ªåŠ¨æ„å»ºé•œåƒï¼‰
docker-compose up --build -d

# 3. æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# 4. æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# 5. ç­‰å¾…æ‰€æœ‰æœåŠ¡å¯åŠ¨å®Œæˆï¼ˆçº¦ 1-2 åˆ†é’Ÿï¼‰
# æ•°æ®åº“åˆå§‹åŒ– â†’ åç«¯å¯åŠ¨ â†’ å‰ç«¯å¯åŠ¨

# 6. è®¿é—®åº”ç”¨
# å‰ç«¯é¡µé¢: http://localhost:8082
# åç«¯ API: http://localhost:8080/api/products
# å¥åº·æ£€æŸ¥: http://localhost:8080/actuator/health
```

#### éªŒè¯éƒ¨ç½²

```bash
# æµ‹è¯•å‰ç«¯
curl http://localhost:8082

# æµ‹è¯•åç«¯ API
curl http://localhost:8080/api/products

# æµ‹è¯•å¥åº·æ£€æŸ¥
curl http://localhost:8080/actuator/health

# æŸ¥çœ‹æ•°æ®åº“
docker exec -it ecommerce-database mysql -u root -p
# å¯†ç : rootpassword
# ç„¶åæ‰§è¡Œ: USE ecommerce; SELECT * FROM products;
```

#### åœæ­¢æœåŠ¡

```bash
# åœæ­¢æ‰€æœ‰æœåŠ¡
docker-compose down

# åœæ­¢å¹¶åˆ é™¤æ•°æ®å·ï¼ˆæ¸…ç©ºæ•°æ®åº“ï¼‰
docker-compose down -v
```

---

### æ–¹å¼äºŒ: Kubernetes + Jenkins (æ¨èç”¨äºç”Ÿäº§ç¯å¢ƒ)

è¿™ç§æ–¹å¼å±•ç¤ºå®Œæ•´çš„ CI/CD æµç¨‹å’Œ Kubernetes éƒ¨ç½²ã€‚

#### æ­¥éª¤ 1: å¯åŠ¨ Minikube

```bash
# å¯åŠ¨ Minikubeï¼ˆåˆ†é…è¶³å¤Ÿèµ„æºï¼‰
minikube start --cpus=4 --memory=8192 --driver=docker

# éªŒè¯é›†ç¾¤çŠ¶æ€
kubectl cluster-info
kubectl get nodes

# å¯ç”¨å¿…è¦çš„æ’ä»¶
minikube addons enable ingress
minikube addons enable metrics-server
```

#### æ­¥éª¤ 2: å¯åŠ¨ Jenkins

```bash
# è¿è¡Œ Jenkins å¯åŠ¨è„šæœ¬ï¼ˆä¼šè‡ªåŠ¨é…ç½® Kubernetes é›†æˆï¼‰
./run-jenkins-local.sh

# è„šæœ¬ä¼šè‡ªåŠ¨ï¼š
# 1. å¯åŠ¨ Jenkins å®¹å™¨
# 2. é…ç½® kubectl è®¿é—®
# 3. å®‰è£…å¿…è¦çš„æ’ä»¶
# 4. æ˜¾ç¤ºåˆå§‹ç®¡ç†å‘˜å¯†ç 

# ç­‰å¾… Jenkins å®Œå…¨å¯åŠ¨ï¼ˆçº¦ 2-3 åˆ†é’Ÿï¼‰
docker logs -f jenkins-local
```

#### æ­¥éª¤ 3: é…ç½® Jenkins

```bash
# 1. è®¿é—® Jenkins
open http://localhost:8090

# 2. ä½¿ç”¨è„šæœ¬æ˜¾ç¤ºçš„åˆå§‹å¯†ç ç™»å½•

# 3. å®‰è£…æ¨èçš„æ’ä»¶

# 4. åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·

# 5. Jenkins å·²è‡ªåŠ¨é…ç½®å¥½ Pipeline ä»»åŠ¡
```

#### æ­¥éª¤ 4: è¿è¡Œ CI/CD Pipeline

```bash
# åœ¨ Jenkins ç•Œé¢æ“ä½œï¼š

# 1. è¿›å…¥ "docker-ecom-coursework" ä»»åŠ¡

# 2. ç‚¹å‡» "Build with Parameters"

# 3. é€‰æ‹©æ„å»ºå‚æ•°ï¼š
#    - K8S_VERSION: green (é€‰æ‹©éƒ¨ç½²ç¯å¢ƒ)
#    - SWITCH_TRAFFIC: âœ“ (è‡ªåŠ¨åˆ‡æ¢æµé‡)
#    - SKIP_TESTS: âœ— (ä¸è·³è¿‡æµ‹è¯•)
#    - DEPLOY_MONITORING: âœ“ (éƒ¨ç½²ç›‘æ§ç³»ç»Ÿ)
#    - PUSH_TO_REGISTRY: âœ“ (æ¨é€é•œåƒ)

# 4. ç‚¹å‡» "Build" å¼€å§‹æ„å»º

# 5. æŸ¥çœ‹æ„å»ºè¿›åº¦å’Œæ—¥å¿—
```

#### æ­¥éª¤ 5: è®¿é—®åº”ç”¨

```bash
# Pipeline å®Œæˆåï¼Œå¯åŠ¨ç«¯å£è½¬å‘
./ci/start-port-forward.sh

# æˆ–æ‰‹åŠ¨æ‰§è¡Œ
kubectl port-forward -n ecommerce --address 0.0.0.0 service/frontend-service 8082:80 &
kubectl port-forward -n ecommerce --address 0.0.0.0 service/backend-service 8080:8080 &

# è®¿é—®åº”ç”¨
# å‰ç«¯: http://localhost:8082
# åç«¯ API: http://localhost:8082/api/products
```

#### æ­¥éª¤ 6: æŸ¥çœ‹ Kubernetes èµ„æº

```bash
# æŸ¥çœ‹æ‰€æœ‰èµ„æº
kubectl get all -n ecommerce

# æŸ¥çœ‹ Pod è¯¦æƒ…
kubectl get pods -n ecommerce -o wide

# æŸ¥çœ‹æœåŠ¡
kubectl get svc -n ecommerce

# æŸ¥çœ‹éƒ¨ç½²
kubectl get deployments -n ecommerce

# æŸ¥çœ‹å½“å‰æµé‡æŒ‡å‘
kubectl get svc frontend-service -n ecommerce -o jsonpath='{.spec.selector}'
```

---

### æ–¹å¼ä¸‰: ä»…éƒ¨ç½²åˆ° Kubernetes (ä¸ä½¿ç”¨ Jenkins)

å¦‚æœåªæƒ³æµ‹è¯• Kubernetes éƒ¨ç½²ï¼Œä¸éœ€è¦å®Œæ•´çš„ CI/CD æµç¨‹ï¼š

```bash
# 1. å¯åŠ¨ Minikube
minikube start --cpus=4 --memory=8192

# 2. æ„å»ºé•œåƒ
docker build -t ecommerce-frontend:latest ./frontend
docker build -t ecommerce-backend:latest ./backend

# 3. åŠ è½½é•œåƒåˆ° Minikube
minikube image load ecommerce-frontend:latest
minikube image load ecommerce-backend:latest

# 4. éƒ¨ç½²åˆ° Kubernetes
kubectl create namespace ecommerce
kubectl apply -f k8s/database/ -n ecommerce
kubectl apply -f k8s/backend/ -n ecommerce
kubectl apply -f k8s/frontend/ -n ecommerce

# 5. ç­‰å¾… Pod å°±ç»ª
kubectl wait --for=condition=available --timeout=300s deployment --all -n ecommerce

# 6. è®¿é—®åº”ç”¨
kubectl port-forward -n ecommerce service/frontend-service 8082:80
```

---

### ğŸ‰ é¦–æ¬¡è®¿é—®

æ— è®ºä½¿ç”¨å“ªç§æ–¹å¼ï¼ŒæˆåŠŸéƒ¨ç½²åè®¿é—® http://localhost:8082ï¼Œä½ å°†çœ‹åˆ°ï¼š

- **äº§å“åˆ—è¡¨é¡µé¢**: å±•ç¤º 8 ä¸ªé¢„ç½®çš„ç”µå­äº§å“
- **äº§å“è¯¦æƒ…**: ç‚¹å‡»ä»»æ„äº§å“æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯
- **å®æ—¶æ•°æ®**: æ‰€æœ‰æ•°æ®æ¥è‡ª MySQL æ•°æ®åº“
- **API äº¤äº’**: å‰ç«¯é€šè¿‡ Nginx åå‘ä»£ç†è°ƒç”¨åç«¯ API

### ğŸ“¸ é¢„æœŸæ•ˆæœ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”µå•†äº§å“ç®¡ç†ç³»ç»Ÿ                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [ç¬”è®°æœ¬ç”µè„‘]  [æ— çº¿é¼ æ ‡]  [æœºæ¢°é”®ç›˜]       â”‚
â”‚  Â¥8999.99     Â¥199.99     Â¥599.99          â”‚
â”‚  åº“å­˜: 25     åº“å­˜: 150    åº“å­˜: 60         â”‚
â”‚                                              â”‚
â”‚  [é™å™ªè€³æœº]   [4Kæ˜¾ç¤ºå™¨]  [é«˜æ¸…æ‘„åƒå¤´]      â”‚
â”‚  Â¥1699.99    Â¥2799.99    Â¥549.99           â”‚
â”‚  åº“å­˜: 40     åº“å­˜: 30     åº“å­˜: 100        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## é¡¹ç›®ç»“æ„

```
docker-ecom-coursework/
â”œâ”€â”€ ğŸ“ frontend/                    # å‰ç«¯æœåŠ¡
â”‚   â”œâ”€â”€ Dockerfile                  # Nginx å¤šé˜¶æ®µæ„å»º
â”‚   â”œâ”€â”€ nginx.conf                  # Nginx é…ç½®ï¼ˆåå‘ä»£ç†ã€Gzipï¼‰
â”‚   â”œâ”€â”€ .dockerignore              # Docker æ„å»ºå¿½ç•¥æ–‡ä»¶
â”‚   â””â”€â”€ html/                       # é™æ€èµ„æº
â”‚       â”œâ”€â”€ index.html             # äº§å“åˆ—è¡¨é¡µé¢
â”‚       â”œâ”€â”€ product-detail.html    # äº§å“è¯¦æƒ…é¡µé¢
â”‚       â”œâ”€â”€ styles.css             # æ ·å¼æ–‡ä»¶
â”‚       â””â”€â”€ script.js              # å‰ç«¯é€»è¾‘
â”‚
â”œâ”€â”€ ğŸ“ backend/                     # åç«¯æœåŠ¡
â”‚   â”œâ”€â”€ Dockerfile                  # Spring Boot å¤šé˜¶æ®µæ„å»º
â”‚   â”œâ”€â”€ pom.xml                     # Maven ä¾èµ–é…ç½®
â”‚   â”œâ”€â”€ .dockerignore              # Docker æ„å»ºå¿½ç•¥æ–‡ä»¶
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ main/
â”‚       â”‚   â”œâ”€â”€ java/com/ecommerce/
â”‚       â”‚   â”‚   â”œâ”€â”€ EcommerceApplication.java      # åº”ç”¨å…¥å£
â”‚       â”‚   â”‚   â”œâ”€â”€ controller/                    # REST æ§åˆ¶å™¨
â”‚       â”‚   â”‚   â”‚   â””â”€â”€ ProductController.java     # äº§å“ API
â”‚       â”‚   â”‚   â”œâ”€â”€ service/                       # ä¸šåŠ¡é€»è¾‘å±‚
â”‚       â”‚   â”‚   â”‚   â””â”€â”€ ProductService.java
â”‚       â”‚   â”‚   â”œâ”€â”€ repository/                    # æ•°æ®è®¿é—®å±‚
â”‚       â”‚   â”‚   â”‚   â””â”€â”€ ProductRepository.java
â”‚       â”‚   â”‚   â”œâ”€â”€ model/                         # å®ä½“ç±»
â”‚       â”‚   â”‚   â”‚   â””â”€â”€ Product.java
â”‚       â”‚   â”‚   â””â”€â”€ exception/                     # å¼‚å¸¸å¤„ç†
â”‚       â”‚   â”‚       â””â”€â”€ GlobalExceptionHandler.java
â”‚       â”‚   â””â”€â”€ resources/
â”‚       â”‚       â”œâ”€â”€ application.yml                # åº”ç”¨é…ç½®
â”‚       â”‚       â””â”€â”€ ValidationMessages_zh_CN.properties
â”‚       â””â”€â”€ test/
â”‚           â”œâ”€â”€ java/com/ecommerce/
â”‚           â”‚   â”œâ”€â”€ controller/                    # æ§åˆ¶å™¨æµ‹è¯•
â”‚           â”‚   â”œâ”€â”€ service/                       # æœåŠ¡æµ‹è¯•
â”‚           â”‚   â””â”€â”€ property/                      # å±æ€§æµ‹è¯•ï¼ˆjqwikï¼‰
â”‚           â””â”€â”€ resources/
â”‚               â””â”€â”€ application-test.yml           # æµ‹è¯•é…ç½®
â”‚
â”œâ”€â”€ ğŸ“ database/                    # æ•°æ®åº“æœåŠ¡
â”‚   â”œâ”€â”€ Dockerfile                  # MySQL é…ç½®
â”‚   â”œâ”€â”€ init.sql                    # æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
â”‚   â””â”€â”€ README.md                   # æ•°æ®åº“æ–‡æ¡£
â”‚
â”œâ”€â”€ ğŸ“ k8s/                         # Kubernetes é…ç½®
â”‚   â”œâ”€â”€ namespace.yaml              # å‘½åç©ºé—´å®šä¹‰
â”‚   â”œâ”€â”€ deploy.sh                   # ä¸€é”®éƒ¨ç½²è„šæœ¬
â”‚   â”œâ”€â”€ cleanup.sh                  # æ¸…ç†è„šæœ¬
â”‚   â”œâ”€â”€ test-deployment.sh          # éƒ¨ç½²æµ‹è¯•è„šæœ¬
â”‚   â”œâ”€â”€ README.md                   # K8s éƒ¨ç½²æ–‡æ¡£
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ database/                # æ•°æ®åº“ K8s èµ„æº
â”‚   â”‚   â”œâ”€â”€ mysql-configmap.yaml   # MySQL é…ç½®
â”‚   â”‚   â”œâ”€â”€ mysql-secret.yaml      # æ•°æ®åº“å¯†ç 
â”‚   â”‚   â”œâ”€â”€ mysql-pvc.yaml         # æŒä¹…åŒ–å·å£°æ˜
â”‚   â”‚   â”œâ”€â”€ mysql-statefulset.yaml # StatefulSet éƒ¨ç½²
â”‚   â”‚   â”œâ”€â”€ mysql-service.yaml     # æ•°æ®åº“æœåŠ¡
â”‚   â”‚   â””â”€â”€ mysql-initdb-configmap.yaml  # åˆå§‹åŒ–è„šæœ¬
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ backend/                 # åç«¯ K8s èµ„æº
â”‚   â”‚   â”œâ”€â”€ backend-configmap.yaml # åç«¯é…ç½®
â”‚   â”‚   â”œâ”€â”€ backend-secret.yaml    # åç«¯å¯†é’¥
â”‚   â”‚   â”œâ”€â”€ backend-deployment.yaml # Deployment éƒ¨ç½²
â”‚   â”‚   â””â”€â”€ backend-service.yaml   # åç«¯æœåŠ¡
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ frontend/                # å‰ç«¯ K8s èµ„æº
â”‚   â”‚   â”œâ”€â”€ frontend-configmap.yaml # å‰ç«¯é…ç½®
â”‚   â”‚   â”œâ”€â”€ frontend-deployment.yaml # Deployment éƒ¨ç½²
â”‚   â”‚   â””â”€â”€ frontend-service.yaml  # å‰ç«¯æœåŠ¡ï¼ˆNodePortï¼‰
â”‚   â”‚
â”‚   â””â”€â”€ ğŸ“ blue-green/              # è“ç»¿éƒ¨ç½²é…ç½®
â”‚       â”œâ”€â”€ README.md               # è“ç»¿éƒ¨ç½²æ–‡æ¡£
â”‚       â”œâ”€â”€ deploy-blue-green.sh   # è“ç»¿éƒ¨ç½²è„šæœ¬
â”‚       â”œâ”€â”€ switch-traffic.sh      # æµé‡åˆ‡æ¢è„šæœ¬
â”‚       â”œâ”€â”€ rollback.sh            # å›æ»šè„šæœ¬
â”‚       â”œâ”€â”€ test-blue-green.sh     # æµ‹è¯•è„šæœ¬
â”‚       â”œâ”€â”€ backend-blue-deployment.yaml    # Blue åç«¯
â”‚       â”œâ”€â”€ backend-green-deployment.yaml   # Green åç«¯
â”‚       â”œâ”€â”€ backend-service-blue-green.yaml # åç«¯æœåŠ¡
â”‚       â”œâ”€â”€ frontend-blue-deployment.yaml   # Blue å‰ç«¯
â”‚       â”œâ”€â”€ frontend-green-deployment.yaml  # Green å‰ç«¯
â”‚       â””â”€â”€ frontend-service-blue-green.yaml # å‰ç«¯æœåŠ¡
â”‚
â”œâ”€â”€ ğŸ“ monitoring/                  # ç›‘æ§ç³»ç»Ÿé…ç½®
â”‚   â”œâ”€â”€ README.md                   # ç›‘æ§æ–‡æ¡£
â”‚   â”œâ”€â”€ ğŸ“ prometheus/              # Prometheus é…ç½®
â”‚   â”‚   â”œâ”€â”€ prometheus.yml         # Prometheus é…ç½®æ–‡ä»¶
â”‚   â”‚   â””â”€â”€ alerts/                # å‘Šè­¦è§„åˆ™
â”‚   â”œâ”€â”€ ğŸ“ grafana/                 # Grafana é…ç½®
â”‚   â”‚   â”œâ”€â”€ dashboards/            # ä»ªè¡¨æ¿å®šä¹‰
â”‚   â”‚   â””â”€â”€ provisioning/          # è‡ªåŠ¨é…ç½®
â”‚   â”œâ”€â”€ ğŸ“ alertmanager/            # Alertmanager é…ç½®
â”‚   â”‚   â”œâ”€â”€ alertmanager.yml       # å‘Šè­¦é…ç½®
â”‚   â”‚   â”œâ”€â”€ alertmanager-deployment.yaml
â”‚   â”‚   â””â”€â”€ alertmanager-service.yaml
â”‚   â””â”€â”€ ğŸ“ scripts/                 # ç›‘æ§è„šæœ¬
â”‚       â”œâ”€â”€ deploy-monitoring.sh   # éƒ¨ç½²ç›‘æ§
â”‚       â””â”€â”€ load-test.sh           # è´Ÿè½½æµ‹è¯•
â”‚
â”œâ”€â”€ ğŸ“ ci/                          # CI/CD è„šæœ¬
â”‚   â”œâ”€â”€ run-jenkins-local.sh       # å¯åŠ¨ Jenkins
â”‚   â”œâ”€â”€ setup-jenkins-k8s.sh       # é…ç½® K8s è®¿é—®
â”‚   â”œâ”€â”€ setup-minikube.sh          # è®¾ç½® Minikube
â”‚   â”œâ”€â”€ setup-docker-registry.sh   # è®¾ç½®é•œåƒä»“åº“
â”‚   â””â”€â”€ start-port-forward.sh      # å¯åŠ¨ç«¯å£è½¬å‘
â”‚
â”œâ”€â”€ ğŸ“ docs/                        # é¡¹ç›®æ–‡æ¡£
â”‚   â”œâ”€â”€ é¡¹ç›®éœ€æ±‚.md                 # é¡¹ç›®éœ€æ±‚æ–‡æ¡£
â”‚   â”œâ”€â”€ apiæ–‡æ¡£.md                  # API æ¥å£æ–‡æ¡£
â”‚   â”œâ”€â”€ éƒ¨ç½²å’Œè¿è¡ŒæŒ‡å—.md           # éƒ¨ç½²æŒ‡å—
â”‚   â”œâ”€â”€ Dockerfile ç¼–å†™æŒ‡å—.md      # Dockerfile æœ€ä½³å®è·µ
â”‚   â”œâ”€â”€ æ•…éšœæ’é™¤æŒ‡å—.md             # æ•…éšœæ’æŸ¥
â”‚   â”œâ”€â”€ APM ç›‘æ§ç³»ç»Ÿè®¾ç½®æŒ‡å—.md     # ç›‘æ§é…ç½®
â”‚   â””â”€â”€ é•œåƒä»“åº“é…ç½®æŒ‡å—.md         # Registry é…ç½®
â”‚
â”œâ”€â”€ ğŸ“ jenkins_home/                # Jenkins æ•°æ®ç›®å½•
â”‚   â”œâ”€â”€ jobs/                       # Jenkins ä»»åŠ¡é…ç½®
â”‚   â”œâ”€â”€ workspace/                  # å·¥ä½œç©ºé—´
â”‚   â””â”€â”€ ...                         # å…¶ä»– Jenkins æ•°æ®
â”‚
â”œâ”€â”€ ğŸ“„ docker-compose.yml           # Docker Compose é…ç½®
â”œâ”€â”€ ğŸ“„ docker-compose.monitoring.yml # ç›‘æ§æ ˆ Compose é…ç½®
â”œâ”€â”€ ğŸ“„ Jenkinsfile                  # Jenkins Pipeline å®šä¹‰
â”œâ”€â”€ ğŸ“„ .env                         # ç¯å¢ƒå˜é‡é…ç½®
â”œâ”€â”€ ğŸ“„ .dockerignore                # Docker å¿½ç•¥æ–‡ä»¶
â”œâ”€â”€ ğŸ“„ .gitignore                   # Git å¿½ç•¥æ–‡ä»¶
â”œâ”€â”€ ğŸ“„ run-jenkins-local.sh         # Jenkins å¿«é€Ÿå¯åŠ¨è„šæœ¬
â””â”€â”€ ğŸ“„ README.md                    # é¡¹ç›®è¯´æ˜æ–‡æ¡£ï¼ˆæœ¬æ–‡ä»¶ï¼‰
```

### å…³é”®æ–‡ä»¶è¯´æ˜

| æ–‡ä»¶ | ç”¨é€” | é‡è¦æ€§ |
|------|------|--------|
| `Jenkinsfile` | å®šä¹‰å®Œæ•´çš„ CI/CD æµæ°´çº¿ | â­â­â­â­â­ |
| `docker-compose.yml` | æœ¬åœ°å¼€å‘ç¯å¢ƒç¼–æ’ | â­â­â­â­â­ |
| `k8s/blue-green/` | è“ç»¿éƒ¨ç½²é…ç½®å’Œè„šæœ¬ | â­â­â­â­â­ |
| `backend/Dockerfile` | åç«¯å¤šé˜¶æ®µæ„å»ºé…ç½® | â­â­â­â­ |
| `frontend/nginx.conf` | Nginx åå‘ä»£ç†é…ç½® | â­â­â­â­ |
| `database/init.sql` | æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬ | â­â­â­â­ |
| `.env` | ç¯å¢ƒå˜é‡é…ç½® | â­â­â­ |

---

## Docker é•œåƒä¼˜åŒ–

### å¤šé˜¶æ®µæ„å»ºç­–ç•¥

é¡¹ç›®ä½¿ç”¨å¤šé˜¶æ®µæ„å»ºå¤§å¹…å‡å°é•œåƒä½“ç§¯ï¼š

#### åç«¯é•œåƒä¼˜åŒ–

```dockerfile
# é˜¶æ®µ 1: æ„å»ºé˜¶æ®µï¼ˆ~800MBï¼‰
FROM maven:3.9-eclipse-temurin-17 AS build
WORKDIR /app
COPY pom.xml .
RUN mvn dependency:go-offline -B  # åˆ©ç”¨å±‚ç¼“å­˜
COPY src ./src
RUN mvn clean package -DskipTests -B

# é˜¶æ®µ 2: è¿è¡Œé˜¶æ®µï¼ˆ~180MBï¼‰
FROM eclipse-temurin:17-jre-alpine
WORKDIR /app
RUN addgroup -S spring && adduser -S spring -G spring  # é root ç”¨æˆ·
COPY --from=build /app/target/*.jar app.jar
USER spring:spring
EXPOSE 8080
HEALTHCHECK --interval=30s --timeout=3s CMD wget --spider http://localhost:8080/actuator/health
ENTRYPOINT ["java", "-jar", "app.jar"]
```

**ä¼˜åŒ–æ•ˆæœ**:
- æ„å»ºé˜¶æ®µ: 800MB (ä¸åŒ…å«åœ¨æœ€ç»ˆé•œåƒ)
- è¿è¡Œé˜¶æ®µ: 180MB
- **ä¼˜åŒ–æ¯”ä¾‹: 77.5%**

#### å‰ç«¯é•œåƒä¼˜åŒ–

```dockerfile
# é˜¶æ®µ 1: å‡†å¤‡é˜¶æ®µ
FROM nginx:alpine AS builder
COPY html /tmp/html

# é˜¶æ®µ 2: è¿è¡Œé˜¶æ®µï¼ˆ~40MBï¼‰
FROM nginx:alpine
COPY nginx.conf /etc/nginx/nginx.conf
COPY --from=builder /tmp/html /usr/share/nginx/html
EXPOSE 80
HEALTHCHECK CMD wget --spider http://127.0.0.1/health
```

**ä¼˜åŒ–æ•ˆæœ**:
- æœ€ç»ˆé•œåƒ: 40MB
- ä½¿ç”¨ Alpine åŸºç¡€é•œåƒ
- **æè‡´è½»é‡åŒ–**

### é•œåƒå¤§å°å¯¹æ¯”

| æœåŠ¡ | æœªä¼˜åŒ– | ä¼˜åŒ–å | ä¼˜åŒ–æ¯”ä¾‹ | çŠ¶æ€ |
|------|--------|--------|---------|------|
| åç«¯ | ~800MB | ~180MB | 77.5% | âœ… |
| å‰ç«¯ | ~140MB | ~40MB | 71.4% | âœ… |
| æ•°æ®åº“ | ~500MB | ~500MB | - | N/A |
| **æ€»è®¡** | **~1440MB** | **~720MB** | **50%** | âœ… |

### ä¼˜åŒ–æŠ€æœ¯

1. **å¤šé˜¶æ®µæ„å»º**: åˆ†ç¦»æ„å»ºå’Œè¿è¡Œç¯å¢ƒ
2. **Alpine åŸºç¡€é•œåƒ**: ä½¿ç”¨è½»é‡çº§ Linux å‘è¡Œç‰ˆ
3. **å±‚ç¼“å­˜**: ä¼˜åŒ– Dockerfile æŒ‡ä»¤é¡ºåº
4. **.dockerignore**: æ’é™¤ä¸å¿…è¦çš„æ–‡ä»¶
5. **JRE vs JDK**: è¿è¡Œæ—¶åªéœ€ JRE
6. **ä¾èµ–é¢„ä¸‹è½½**: å•ç‹¬å¤åˆ¶ pom.xml åˆ©ç”¨ç¼“å­˜

---

## Jenkins CI/CD Pipeline

### Pipeline æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Jenkins Pipeline æµç¨‹                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é˜¶æ®µ 1: ç¯å¢ƒä¿¡æ¯                                                â”‚
â”‚  - æ˜¾ç¤ºæ„å»ºå‚æ•°                                                  â”‚
â”‚  - æ˜¾ç¤ºç¯å¢ƒé…ç½®                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é˜¶æ®µ 2: ä»£ç æ£€å‡º                                                â”‚
â”‚  - ä» GitHub å…‹éš†ä»£ç                                             â”‚
â”‚  - æµ…å…‹éš†ä¼˜åŒ–ï¼ˆdepth=1ï¼‰                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é˜¶æ®µ 3: æ„å»ºé˜¶æ®µ                                                â”‚
â”‚  - Maven ç¼–è¯‘æ‰“åŒ…                                                â”‚
â”‚  - Docker æ„å»ºé•œåƒ                                               â”‚
â”‚  - æ ‡è®°é•œåƒç‰ˆæœ¬                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é˜¶æ®µ 4: å•å…ƒæµ‹è¯•                                                â”‚
â”‚  - JUnit æµ‹è¯•æ‰§è¡Œ                                                â”‚
â”‚  - æµ‹è¯•æŠ¥å‘Šç”Ÿæˆ                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é˜¶æ®µ 5: é›†æˆæµ‹è¯•                                                â”‚
â”‚  - jqwik å±æ€§æµ‹è¯•                                                â”‚
â”‚  - 100+ æ¬¡éšæœºæµ‹è¯•                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é˜¶æ®µ 6: ä»£ç è¦†ç›–ç‡                                              â”‚
â”‚  - JaCoCo æŠ¥å‘Šç”Ÿæˆ                                               â”‚
â”‚  - è¦†ç›–ç‡æ£€æŸ¥ï¼ˆâ‰¥80%ï¼‰                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é˜¶æ®µ 7: æ¨é€é•œåƒ                                                â”‚
â”‚  - æ¨é€åˆ° Docker Registry                                        â”‚
â”‚  - æ ‡è®° latest å’Œç‰ˆæœ¬å·                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é˜¶æ®µ 8: Kubernetes è“ç»¿éƒ¨ç½²                                     â”‚
â”‚  - åŠ è½½é•œåƒåˆ° Minikube                                           â”‚
â”‚  - éƒ¨ç½²åˆ° Blue/Green ç¯å¢ƒ                                        â”‚
â”‚  - ç­‰å¾… Pod å°±ç»ª                                                 â”‚
â”‚  - å¯é€‰ï¼šè‡ªåŠ¨åˆ‡æ¢æµé‡                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é˜¶æ®µ 9: å¥åº·æ£€æŸ¥                                                â”‚
â”‚  - éªŒè¯ Pod çŠ¶æ€                                                 â”‚
â”‚  - æµ‹è¯•æœåŠ¡å¯è®¿é—®æ€§                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é˜¶æ®µ 10: éƒ¨ç½²ç›‘æ§ï¼ˆå¯é€‰ï¼‰                                       â”‚
â”‚  - éƒ¨ç½² Prometheus                                               â”‚
â”‚  - éƒ¨ç½² Grafana                                                  â”‚
â”‚  - éƒ¨ç½² Alertmanager                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é˜¶æ®µ 11: éƒ¨ç½²éªŒè¯                                               â”‚
â”‚  - ç«¯åˆ°ç«¯æµ‹è¯•                                                    â”‚
â”‚  - ç”Ÿæˆéƒ¨ç½²æŠ¥å‘Š                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è‡ªåŠ¨åŒ–è§¦å‘æœºåˆ¶

#### Git è½®è¯¢é…ç½®

```groovy
triggers {
    pollSCM('H/2 * * * *')  // æ¯ 2 åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡ä»£ç å˜æ›´
}
```

**å·¥ä½œåŸç†**:
1. Jenkins æ¯ 2 åˆ†é’Ÿæ£€æŸ¥ Git ä»“åº“
2. æ£€æµ‹åˆ°æ–°æäº¤æ—¶è‡ªåŠ¨è§¦å‘æ„å»º
3. ä½¿ç”¨ SCM è½®è¯¢é¿å… Webhook é…ç½®
4. æ”¯æŒå¤šåˆ†æ”¯åŒæ—¶ç›‘æ§

#### æ‰‹åŠ¨è§¦å‘

```bash
# åœ¨ Jenkins ç•Œé¢
1. è¿›å…¥ä»»åŠ¡é¡µé¢
2. ç‚¹å‡» "Build with Parameters"
3. é€‰æ‹©æ„å»ºå‚æ•°
4. ç‚¹å‡» "Build"
```

### æ„å»ºå‚æ•°è¯¦è§£

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `K8S_VERSION` | Choice | blue | éƒ¨ç½²ç›®æ ‡ç¯å¢ƒï¼ˆblue/greenï¼‰ |
| `SWITCH_TRAFFIC` | Boolean | false | æ˜¯å¦è‡ªåŠ¨åˆ‡æ¢æµé‡åˆ°æ–°ç¯å¢ƒ |
| `SKIP_TESTS` | Boolean | false | æ˜¯å¦è·³è¿‡æµ‹è¯•ï¼ˆå¿«é€Ÿéƒ¨ç½²ï¼‰ |
| `DEPLOY_MONITORING` | Boolean | false | æ˜¯å¦éƒ¨ç½²ç›‘æ§ç³»ç»Ÿ |
| `PUSH_TO_REGISTRY` | Boolean | true | æ˜¯å¦æ¨é€é•œåƒåˆ°ä»“åº“ |

### ä½¿ç”¨åœºæ™¯ç¤ºä¾‹

#### åœºæ™¯ 1: æ ‡å‡†éƒ¨ç½²åˆ° Green ç¯å¢ƒ

```groovy
K8S_VERSION = 'green'
SWITCH_TRAFFIC = false
SKIP_TESTS = false
DEPLOY_MONITORING = false
PUSH_TO_REGISTRY = true
```

**æµç¨‹**: æ„å»º â†’ æµ‹è¯• â†’ éƒ¨ç½²åˆ° Green â†’ æ‰‹åŠ¨éªŒè¯ â†’ æ‰‹åŠ¨åˆ‡æ¢æµé‡

#### åœºæ™¯ 2: å¿«é€Ÿçƒ­ä¿®å¤

```groovy
K8S_VERSION = 'green'
SWITCH_TRAFFIC = true
SKIP_TESTS = true
DEPLOY_MONITORING = false
PUSH_TO_REGISTRY = true
```

**æµç¨‹**: æ„å»º â†’ è·³è¿‡æµ‹è¯• â†’ éƒ¨ç½²åˆ° Green â†’ è‡ªåŠ¨åˆ‡æ¢æµé‡

âš ï¸ **è­¦å‘Š**: ä»…åœ¨ç´§æ€¥æƒ…å†µä½¿ç”¨ï¼Œè·³è¿‡æµ‹è¯•æœ‰é£é™©ï¼

#### åœºæ™¯ 3: å®Œæ•´éƒ¨ç½² + ç›‘æ§

```groovy
K8S_VERSION = 'green'
SWITCH_TRAFFIC = true
SKIP_TESTS = false
DEPLOY_MONITORING = true
PUSH_TO_REGISTRY = true
```

**æµç¨‹**: å®Œæ•´æµ‹è¯• â†’ éƒ¨ç½²åº”ç”¨ â†’ éƒ¨ç½²ç›‘æ§ â†’ è‡ªåŠ¨åˆ‡æ¢æµé‡

### Pipeline å…³é”®ç‰¹æ€§

#### 1. å¤±è´¥å®‰å…¨æœºåˆ¶

```groovy
stage('æ ‡è®°æ„å»ºæˆåŠŸ') {
    steps {
        script {
            env.BUILD_SUCCESS = 'true'
        }
    }
}

stage('Kubernetesè“ç»¿éƒ¨ç½²') {
    when {
        expression { env.BUILD_SUCCESS == 'true' }
    }
    // åªæœ‰æµ‹è¯•é€šè¿‡æ‰éƒ¨ç½²
}
```

**ä¿è¯**: æµ‹è¯•å¤±è´¥æ—¶ä¸ä¼šéƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

#### 2. å¥åº·æ£€æŸ¥

```groovy
kubectl wait --for=condition=available \
    deployment/backend-green \
    -n ecommerce \
    --timeout=300s
```

**ä¿è¯**: åªæœ‰ Pod å®Œå…¨å°±ç»ªæ‰ç»§ç»­

#### 3. æµ‹è¯•æŠ¥å‘Š

```groovy
post {
    always {
        junit 'backend/target/surefire-reports/*.xml'
        jacoco execPattern: 'backend/target/jacoco.exec'
    }
}
```

**æä¾›**: 
- JUnit æµ‹è¯•æŠ¥å‘Š
- JaCoCo è¦†ç›–ç‡æŠ¥å‘Š
- è¶‹åŠ¿åˆ†æå›¾è¡¨

### Git ä»“åº“é…ç½®

```groovy
environment {
    GIT_REPO = 'https://github.com/pahhcn/docker-ecom-coursework.git'
    GIT_BRANCH = 'main'
}

checkout([
    $class: 'GitSCM',
    branches: [[name: "*/${GIT_BRANCH}"]],
    userRemoteConfigs: [[url: "${GIT_REPO}"]],
    extensions: [
        [$class: 'CloneOption', depth: 1, shallow: true]
    ]
])
```

**ä¼˜åŒ–**:
- æµ…å…‹éš†ï¼ˆdepth=1ï¼‰åŠ é€Ÿæ£€å‡º
- æ”¯æŒå¤šåˆ†æ”¯
- è‡ªåŠ¨æ¸…ç†å·¥ä½œç©ºé—´

### æ„å»ºæ—¶é—´åˆ†æ

| é˜¶æ®µ | å¹³å‡è€—æ—¶ | å æ¯” |
|------|---------|------|
| ä»£ç æ£€å‡º | 10s | 3% |
| Maven æ„å»º | 60s | 20% |
| Docker æ„å»º | 45s | 15% |
| å•å…ƒæµ‹è¯• | 30s | 10% |
| é›†æˆæµ‹è¯• | 40s | 13% |
| è¦†ç›–ç‡æŠ¥å‘Š | 15s | 5% |
| æ¨é€é•œåƒ | 30s | 10% |
| K8s éƒ¨ç½² | 60s | 20% |
| å¥åº·æ£€æŸ¥ | 12s | 4% |
| **æ€»è®¡** | **~5åˆ†é’Ÿ** | **100%** |

### æŸ¥çœ‹æ„å»ºç»“æœ

#### Jenkins ç•Œé¢

```
1. è¿›å…¥æ„å»ºé¡µé¢
2. æŸ¥çœ‹ "Console Output" - å®Œæ•´æ—¥å¿—
3. æŸ¥çœ‹ "Test Result" - æµ‹è¯•æŠ¥å‘Š
4. æŸ¥çœ‹ "JaCoCo Coverage" - è¦†ç›–ç‡æŠ¥å‘Š
5. æŸ¥çœ‹ "Build Artifacts" - æ„å»ºäº§ç‰©
```

#### å‘½ä»¤è¡ŒæŸ¥çœ‹

```bash
# æŸ¥çœ‹ Jenkins æ—¥å¿—
docker logs -f jenkins-local

# æŸ¥çœ‹ Kubernetes éƒ¨ç½²
kubectl get all -n ecommerce

# æŸ¥çœ‹ Pod æ—¥å¿—
kubectl logs -f deployment/backend-green -n ecommerce
```

---

## Kubernetes è“ç»¿éƒ¨ç½²

### è“ç»¿éƒ¨ç½²åŸç†

è“ç»¿éƒ¨ç½²æ˜¯ä¸€ç§é›¶åœæœºéƒ¨ç½²ç­–ç•¥ï¼Œé€šè¿‡ç»´æŠ¤ä¸¤å¥—å®Œå…¨ç›¸åŒçš„ç”Ÿäº§ç¯å¢ƒæ¥å®ç°å¹³æ»‘æ›´æ–°ã€‚

```
åˆå§‹çŠ¶æ€ï¼šBlue ç¯å¢ƒå¤„ç†æ‰€æœ‰æµé‡
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Service (selector: version=blue)           â”‚
â”‚              â”‚                               â”‚
â”‚              â–¼                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Blue ç¯å¢ƒ       â”‚    â”‚ Green ç¯å¢ƒ   â”‚  â”‚
â”‚  â”‚  (v1.0)          â”‚    â”‚ (ç©ºé—²)       â”‚  â”‚
â”‚  â”‚  âœ… å¤„ç†æµé‡     â”‚    â”‚ â¸ï¸  å¾…å‘½     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

éƒ¨ç½²æ–°ç‰ˆæœ¬åˆ° Green ç¯å¢ƒ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Service (selector: version=blue)           â”‚
â”‚              â”‚                               â”‚
â”‚              â–¼                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Blue ç¯å¢ƒ       â”‚    â”‚ Green ç¯å¢ƒ   â”‚  â”‚
â”‚  â”‚  (v1.0)          â”‚    â”‚ (v2.0)       â”‚  â”‚
â”‚  â”‚  âœ… å¤„ç†æµé‡     â”‚    â”‚ ğŸ”„ éƒ¨ç½²ä¸­    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

åˆ‡æ¢æµé‡åˆ° Green ç¯å¢ƒ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Service (selector: version=green)          â”‚
â”‚                          â”‚                   â”‚
â”‚                          â–¼                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Blue ç¯å¢ƒ       â”‚    â”‚ Green ç¯å¢ƒ   â”‚  â”‚
â”‚  â”‚  (v1.0)          â”‚    â”‚ (v2.0)       â”‚  â”‚
â”‚  â”‚  â¸ï¸  å¾…å‘½        â”‚    â”‚ âœ… å¤„ç†æµé‡  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å¦‚éœ€å›æ»šï¼Œç«‹å³åˆ‡å› Blue
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Service (selector: version=blue)           â”‚
â”‚              â”‚                               â”‚
â”‚              â–¼                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Blue ç¯å¢ƒ       â”‚    â”‚ Green ç¯å¢ƒ   â”‚  â”‚
â”‚  â”‚  (v1.0)          â”‚    â”‚ (v2.0)       â”‚  â”‚
â”‚  â”‚  âœ… å¤„ç†æµé‡     â”‚    â”‚ âŒ æœ‰é—®é¢˜    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒä¼˜åŠ¿

| ä¼˜åŠ¿ | è¯´æ˜ |
|------|------|
| âš¡ é›¶åœæœº | æµé‡åˆ‡æ¢ç¬é—´å®Œæˆï¼Œç”¨æˆ·æ— æ„ŸçŸ¥ |
| ğŸ”„ å¿«é€Ÿå›æ»š | å‘ç°é—®é¢˜ç«‹å³åˆ‡å›æ—§ç‰ˆæœ¬ |
| ğŸ§ª ç”Ÿäº§æµ‹è¯• | æ–°ç‰ˆæœ¬åœ¨ç”Ÿäº§ç¯å¢ƒæµ‹è¯•åå†åˆ‡æ¢æµé‡ |
| ğŸ›¡ï¸ é£é™©éš”ç¦» | æ–°æ—§ç‰ˆæœ¬å®Œå…¨éš”ç¦»ï¼Œäº’ä¸å½±å“ |
| ğŸ“Š å¯¹æ¯”åˆ†æ | å¯åŒæ—¶ç›‘æ§ä¸¤ä¸ªç‰ˆæœ¬çš„æ€§èƒ½æŒ‡æ ‡ |

### éƒ¨ç½²æµç¨‹è¯¦è§£

#### æ­¥éª¤ 1: éƒ¨ç½²åˆ° Green ç¯å¢ƒ

```bash
# ä½¿ç”¨ Jenkins Pipeline
K8S_VERSION=green
SWITCH_TRAFFIC=false  # å…ˆä¸åˆ‡æ¢æµé‡

# æˆ–æ‰‹åŠ¨éƒ¨ç½²
cd k8s/blue-green
./deploy-blue-green.sh green
```

**æ‰§è¡Œå†…å®¹**:
```bash
# 1. åˆ›å»ºå‘½åç©ºé—´
kubectl create namespace ecommerce

# 2. éƒ¨ç½²æ•°æ®åº“ï¼ˆå…±äº«ï¼‰
kubectl apply -f k8s/database/ -n ecommerce

# 3. éƒ¨ç½² Green ç¯å¢ƒ
kubectl apply -f backend-green-deployment.yaml -n ecommerce
kubectl apply -f frontend-green-deployment.yaml -n ecommerce

# 4. ç­‰å¾… Pod å°±ç»ª
kubectl wait --for=condition=available \
    deployment/backend-green \
    -n ecommerce \
    --timeout=300s
```

#### æ­¥éª¤ 2: æµ‹è¯• Green ç¯å¢ƒ

```bash
# ç›´æ¥è®¿é—® Green ç¯å¢ƒçš„ Pod
kubectl port-forward -n ecommerce \
    deployment/frontend-green 8083:80

# åœ¨æµè§ˆå™¨æµ‹è¯•
open http://localhost:8083

# æµ‹è¯• API
curl http://localhost:8083/api/products

# æŸ¥çœ‹ Pod æ—¥å¿—
kubectl logs -f deployment/backend-green -n ecommerce

# æŸ¥çœ‹ Pod çŠ¶æ€
kubectl get pods -n ecommerce -l version=green
```

#### æ­¥éª¤ 3: åˆ‡æ¢æµé‡

```bash
# ä½¿ç”¨è„šæœ¬åˆ‡æ¢
cd k8s/blue-green
./switch-traffic.sh green

# æˆ–æ‰‹åŠ¨åˆ‡æ¢
kubectl patch service backend-service -n ecommerce \
    -p '{"spec":{"selector":{"version":"green"}}}'

kubectl patch service frontend-service -n ecommerce \
    -p '{"spec":{"selector":{"version":"green"}}}'
```

**éªŒè¯åˆ‡æ¢**:
```bash
# æŸ¥çœ‹ Service çš„ selector
kubectl get svc backend-service -n ecommerce -o yaml | grep -A 3 selector

# è¾“å‡ºåº”è¯¥æ˜¾ç¤º:
# selector:
#   app: backend
#   version: green
```

#### æ­¥éª¤ 4: ç›‘æ§æ–°ç‰ˆæœ¬

```bash
# æŸ¥çœ‹ Pod çŠ¶æ€
watch kubectl get pods -n ecommerce

# æŸ¥çœ‹æœåŠ¡æ—¥å¿—
kubectl logs -f deployment/backend-green -n ecommerce

# æŸ¥çœ‹èµ„æºä½¿ç”¨
kubectl top pods -n ecommerce

# è®¿é—®åº”ç”¨éªŒè¯
curl http://localhost:8082/api/products
```

#### æ­¥éª¤ 5: å›æ»šï¼ˆå¦‚éœ€è¦ï¼‰

```bash
# å¿«é€Ÿå›æ»šåˆ° Blue
./switch-traffic.sh blue

# æˆ–æ‰‹åŠ¨å›æ»š
kubectl patch service backend-service -n ecommerce \
    -p '{"spec":{"selector":{"version":"blue"}}}'

kubectl patch service frontend-service -n ecommerce \
    -p '{"spec":{"selector":{"version":"blue"}}}'
```

**å›æ»šæ—¶é—´**: < 5 ç§’ âš¡

### éƒ¨ç½²è„šæœ¬è¯´æ˜

#### deploy-blue-green.sh

```bash
#!/bin/bash
# ç”¨æ³•: ./deploy-blue-green.sh [blue|green]

VERSION=$1

# éƒ¨ç½²æŒ‡å®šç‰ˆæœ¬
kubectl apply -f backend-${VERSION}-deployment.yaml -n ecommerce
kubectl apply -f frontend-${VERSION}-deployment.yaml -n ecommerce

# ç­‰å¾…å°±ç»ª
kubectl wait --for=condition=available \
    deployment/backend-${VERSION} \
    -n ecommerce \
    --timeout=300s

echo "âœ… ${VERSION} ç¯å¢ƒéƒ¨ç½²å®Œæˆ"
```

#### switch-traffic.sh

```bash
#!/bin/bash
# ç”¨æ³•: ./switch-traffic.sh [blue|green]

VERSION=$1

# åˆ‡æ¢åç«¯æµé‡
kubectl patch service backend-service -n ecommerce \
    -p "{\"spec\":{\"selector\":{\"version\":\"${VERSION}\"}}}"

# åˆ‡æ¢å‰ç«¯æµé‡
kubectl patch service frontend-service -n ecommerce \
    -p "{\"spec\":{\"selector\":{\"version\":\"${VERSION}\"}}}"

echo "âœ… æµé‡å·²åˆ‡æ¢åˆ° ${VERSION} ç¯å¢ƒ"
```

#### rollback.sh

```bash
#!/bin/bash
# å¿«é€Ÿå›æ»šåˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬

CURRENT=$(kubectl get svc backend-service -n ecommerce \
    -o jsonpath='{.spec.selector.version}')

if [ "$CURRENT" == "blue" ]; then
    TARGET="green"
else
    TARGET="blue"
fi

./switch-traffic.sh $TARGET
echo "âœ… å·²å›æ»šåˆ° ${TARGET} ç¯å¢ƒ"
```

### Kubernetes èµ„æºé…ç½®

#### Backend Blue Deployment

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: backend-blue
  namespace: ecommerce
spec:
  replicas: 2
  selector:
    matchLabels:
      app: backend
      version: blue
  template:
    metadata:
      labels:
        app: backend
        version: blue
    spec:
      containers:
      - name: backend
        image: ecommerce-backend:latest
        ports:
        - containerPort: 8080
        env:
        - name: SPRING_PROFILES_ACTIVE
          value: "prod"
        resources:
          limits:
            cpu: "1"
            memory: "512Mi"
          requests:
            cpu: "500m"
            memory: "256Mi"
        livenessProbe:
          httpGet:
            path: /actuator/health
            port: 8080
          initialDelaySeconds: 60
          periodSeconds: 10
        readinessProbe:
          httpGet:
            path: /actuator/health
            port: 8080
          initialDelaySeconds: 30
          periodSeconds: 5
```

#### Service é…ç½®

```yaml
apiVersion: v1
kind: Service
metadata:
  name: backend-service
  namespace: ecommerce
spec:
  selector:
    app: backend
    version: blue  # é€šè¿‡ä¿®æ”¹è¿™é‡Œåˆ‡æ¢æµé‡
  ports:
  - protocol: TCP
    port: 8080
    targetPort: 8080
  type: ClusterIP
```

### æœ€ä½³å®è·µ

#### 1. æ¸è¿›å¼åˆ‡æ¢

```bash
# å…ˆåˆ‡æ¢ 10% æµé‡æµ‹è¯•
kubectl apply -f backend-service-canary.yaml

# è§‚å¯ŸæŒ‡æ ‡æ­£å¸¸åå†å…¨é‡åˆ‡æ¢
./switch-traffic.sh green
```

#### 2. å¥åº·æ£€æŸ¥

```yaml
livenessProbe:
  httpGet:
    path: /actuator/health
    port: 8080
  initialDelaySeconds: 60
  periodSeconds: 10
  failureThreshold: 3

readinessProbe:
  httpGet:
    path: /actuator/health
    port: 8080
  initialDelaySeconds: 30
  periodSeconds: 5
  failureThreshold: 3
```

#### 3. èµ„æºé™åˆ¶

```yaml
resources:
  limits:
    cpu: "1"
    memory: "512Mi"
  requests:
    cpu: "500m"
    memory: "256Mi"
```

#### 4. æ»šåŠ¨æ›´æ–°ç­–ç•¥

```yaml
strategy:
  type: RollingUpdate
  rollingUpdate:
    maxSurge: 1
    maxUnavailable: 0
```

### å¸¸è§é—®é¢˜

#### Q: ä¸¤ä¸ªç¯å¢ƒæ˜¯å¦å…±äº«æ•°æ®åº“ï¼Ÿ

**A**: æ˜¯çš„ï¼ŒBlue å’Œ Green ç¯å¢ƒå…±äº«åŒä¸€ä¸ªæ•°æ®åº“å®ä¾‹ã€‚è¿™æ ·å¯ä»¥ï¼š
- é¿å…æ•°æ®åŒæ­¥é—®é¢˜
- ç®€åŒ–éƒ¨ç½²æµç¨‹
- ç¡®ä¿æ•°æ®ä¸€è‡´æ€§

âš ï¸ **æ³¨æ„**: æ•°æ®åº“ schema å˜æ›´éœ€è¦å‘åå…¼å®¹ã€‚

#### Q: å¦‚ä½•å¤„ç†æ•°æ®åº“è¿ç§»ï¼Ÿ

**A**: ä½¿ç”¨å‘åå…¼å®¹çš„è¿ç§»ç­–ç•¥ï¼š
1. å…ˆéƒ¨ç½²å…¼å®¹æ–°æ—§ä»£ç çš„æ•°æ®åº“å˜æ›´
2. éƒ¨ç½²æ–°ç‰ˆæœ¬åº”ç”¨åˆ° Green
3. åˆ‡æ¢æµé‡
4. æ¸…ç†æ—§çš„æ•°æ®åº“ç»“æ„

#### Q: åˆ‡æ¢æµé‡éœ€è¦å¤šé•¿æ—¶é—´ï¼Ÿ

**A**: é€šå¸¸ < 5 ç§’ã€‚Service çš„ selector æ›´æ–°æ˜¯åŸå­æ“ä½œã€‚

#### Q: å¦‚ä½•éªŒè¯åˆ‡æ¢æˆåŠŸï¼Ÿ

```bash
# æŸ¥çœ‹ Service selector
kubectl get svc -n ecommerce -o yaml | grep -A 3 selector

# æŸ¥çœ‹æµé‡åˆ†å¸ƒ
kubectl get endpoints -n ecommerce

# æµ‹è¯•è®¿é—®
curl http://localhost:8082/api/products
```

## API ç«¯ç‚¹

### äº§å“ç®¡ç† API

| æ–¹æ³• | ç«¯ç‚¹ | æè¿° | å“åº” |
|------|------|------|------|
| GET | /api/products | è·å–æ‰€æœ‰äº§å“ | 200 + Product[] |
| GET | /api/products/{id} | è·å–å•ä¸ªäº§å“ | 200 + Product |
| POST | /api/products | åˆ›å»ºäº§å“ | 201 + Product |
| PUT | /api/products/{id} | æ›´æ–°äº§å“ | 200 + Product |
| DELETE | /api/products/{id} | åˆ é™¤äº§å“ | 204 |

### å¥åº·æ£€æŸ¥

| ç«¯ç‚¹ | æè¿° |
|------|------|
| /actuator/health | åç«¯å¥åº·æ£€æŸ¥ |
| /health | å‰ç«¯å¥åº·æ£€æŸ¥ |

### äº§å“å¯¹è±¡ç¤ºä¾‹

```json
{
  "id": 1,
  "name": "äº§å“åç§°",
  "description": "äº§å“æè¿°",
  "price": 99.99,
  "stockQuantity": 100,
  "category": "ç”µå­äº§å“",
  "imageUrl": "https://example.com/image.jpg",
  "createdAt": "2025-11-24T10:00:00",
  "updatedAt": "2025-11-24T10:00:00"
}
```

## æµ‹è¯•

### è¿è¡Œæµ‹è¯•

```bash
# å•å…ƒæµ‹è¯•
cd backend
mvn test

# é›†æˆæµ‹è¯•
mvn verify

# å±æ€§æµ‹è¯•
mvn test -Dtest=*PropertyTest

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
mvn jacoco:report
```

### æµ‹è¯•ç±»å‹

1. **å•å…ƒæµ‹è¯•** - æµ‹è¯•å•ä¸ªç»„ä»¶åŠŸèƒ½
2. **å±æ€§æµ‹è¯•** - ä½¿ç”¨ jqwik è¿›è¡Œéšæœºè¾“å…¥æµ‹è¯• (100+ æ¬¡è¿­ä»£)
3. **é›†æˆæµ‹è¯•** - ä½¿ç”¨ TestContainers æµ‹è¯•æœåŠ¡äº¤äº’
4. **ç«¯åˆ°ç«¯æµ‹è¯•** - éªŒè¯å®Œæ•´ä¸šåŠ¡æµç¨‹

### è¦†ç›–ç‡æŠ¥å‘Š

Jenkins Pipeline è‡ªåŠ¨ç”Ÿæˆ JaCoCo è¦†ç›–ç‡æŠ¥å‘Šï¼š
- æŠ¥å‘Šä½ç½®: `backend/target/site/jacoco/index.html`
- Jenkins ä¸­æŸ¥çœ‹: Build > JaCoCo Coverage Report

## ç›‘æ§

### Prometheus + Grafana

ç›‘æ§ç³»ç»Ÿæä¾›ï¼š
- å®æ—¶æŒ‡æ ‡æ”¶é›†
- å¯è§†åŒ–ä»ªè¡¨æ¿
- å‘Šè­¦é…ç½®
- å®¹å™¨èµ„æºç›‘æ§

### è®¿é—®ç›‘æ§æœåŠ¡

```bash
# é€šè¿‡ Docker Compose
docker-compose -f docker-compose.monitoring.yml up -d

# è®¿é—®åœ°å€
# Grafana: http://localhost:3000 (admin/admin)
# Prometheus: http://localhost:9090
# Alertmanager: http://localhost:9093
```

### Kubernetes ç›‘æ§

```bash
# éƒ¨ç½²ç›‘æ§åˆ° Kubernetes
kubectl create namespace monitoring
kubectl apply -f monitoring/prometheus/ -n monitoring
kubectl apply -f monitoring/grafana/ -n monitoring

# è®¿é—®æœåŠ¡
kubectl port-forward -n monitoring service/grafana 3000:3000
kubectl port-forward -n monitoring service/prometheus 9090:9090
```

## å¸¸ç”¨å‘½ä»¤

### Docker Compose

```bash
# å¯åŠ¨æœåŠ¡
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# åœæ­¢æœåŠ¡
docker-compose down

# é‡å»ºå¹¶å¯åŠ¨
docker-compose up --build -d
```

### Kubernetes

```bash
# æŸ¥çœ‹æ‰€æœ‰èµ„æº
kubectl get all -n ecommerce

# æŸ¥çœ‹ Pod æ—¥å¿—
kubectl logs -f deployment/backend -n ecommerce

# æ‰©å±•å‰¯æœ¬æ•°
kubectl scale deployment/backend --replicas=3 -n ecommerce

# æŸ¥çœ‹æœåŠ¡
kubectl get services -n ecommerce

# ç«¯å£è½¬å‘
kubectl port-forward -n ecommerce service/frontend-service 8082:80
```

### Jenkins

```bash
# å¯åŠ¨ Jenkins
./ci/run-jenkins-local.sh

# æŸ¥çœ‹ Jenkins æ—¥å¿—
docker logs -f jenkins-local

# åœæ­¢ Jenkins
docker stop jenkins-local

# é‡å¯ Jenkins
docker restart jenkins-local
```

## ç¯å¢ƒå˜é‡

ä¸»è¦ç¯å¢ƒå˜é‡é…ç½® (`.env` æ–‡ä»¶):

```bash
# æ•°æ®åº“é…ç½®
MYSQL_ROOT_PASSWORD=rootpassword
MYSQL_DATABASE=ecommerce
MYSQL_USER=ecommerce_user
MYSQL_PASSWORD=ecommerce_password

# åç«¯é…ç½®
DB_HOST=database
DB_PORT=3306
DB_NAME=ecommerce
DB_USER=ecommerce_user
DB_PASSWORD=ecommerce_password
SPRING_PROFILES_ACTIVE=dev
```

## æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜

**1. Jenkins æ— æ³•è®¿é—® Kubernetes**

```bash
# é‡æ–°é…ç½® Kubernetes è®¿é—®
./ci/setup-jenkins-k8s.sh

# éªŒè¯é…ç½®
docker exec jenkins-local kubectl get nodes
```

**2. Pod æ— æ³•å¯åŠ¨**

```bash
# æŸ¥çœ‹ Pod è¯¦æƒ…
kubectl describe pod <pod-name> -n ecommerce

# æŸ¥çœ‹æ—¥å¿—
kubectl logs <pod-name> -n ecommerce

# æ£€æŸ¥é•œåƒ
minikube image ls | grep ecommerce
```

**3. æœåŠ¡æ— æ³•è®¿é—®**

```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
kubectl get services -n ecommerce

# é‡å¯ç«¯å£è½¬å‘
./ci/k8s-access.sh

# æ£€æŸ¥ Pod å¥åº·
kubectl get pods -n ecommerce
```

**4. æ•°æ®åº“è¿æ¥å¤±è´¥**

```bash
# æ£€æŸ¥æ•°æ®åº“ Pod
kubectl get pods -n ecommerce -l app=mysql

# æŸ¥çœ‹æ•°æ®åº“æ—¥å¿—
kubectl logs -f statefulset/mysql -n ecommerce

# æµ‹è¯•è¿æ¥
kubectl exec -it mysql-0 -n ecommerce -- mysql -u root -p
```

## å®‰å…¨æ³¨æ„äº‹é¡¹

**è­¦å‘Š**: æœ¬é¡¹ç›®åŒ…å«ç”¨äºå¼€å‘çš„ç¡¬ç¼–ç å‡­è¯ï¼Œä¸åº”åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ã€‚

### ç”Ÿäº§éƒ¨ç½²å‰å¿…é¡»:

1. æ›´æ”¹æ‰€æœ‰é»˜è®¤å¯†ç 
2. ä½¿ç”¨ Kubernetes Secrets ç®¡ç†æ•æ„Ÿä¿¡æ¯
3. å¯ç”¨ TLS/SSL
4. é…ç½®ç½‘ç»œç­–ç•¥
5. å®æ–½è®¿é—®æ§åˆ¶
6. å®šæœŸæ›´æ–°ä¾èµ–

è¯¦ç»†å®‰å…¨å»ºè®®è¯·å‚é˜… `docs/` ç›®å½•ä¸­çš„å®‰å…¨æ–‡æ¡£ã€‚

## æ–‡æ¡£

### æ ¸å¿ƒæ–‡æ¡£
- [æ¶æ„æ–‡æ¡£](docs/architecture.md) - ç³»ç»Ÿæ¶æ„å’Œè®¾è®¡å†³ç­–
- [éƒ¨ç½²æŒ‡å—](docs/deployment.md) - è¯¦ç»†éƒ¨ç½²è¯´æ˜
- [API æ–‡æ¡£](docs/api.md) - REST API å‚è€ƒ
- [æ•…éšœæ’æŸ¥](docs/troubleshooting.md) - å¸¸è§é—®é¢˜è§£å†³

### Kubernetes æ–‡æ¡£
- [K8s éƒ¨ç½²æŒ‡å—](k8s/README.md) - Kubernetes éƒ¨ç½²è¯¦è§£
- [è“ç»¿éƒ¨ç½²](k8s/blue-green/README.md) - è“ç»¿éƒ¨ç½²ç­–ç•¥
- [ç›‘æ§è®¾ç½®](docs/monitoring-setup.md) - ç›‘æ§ç³»ç»Ÿé…ç½®

### CI/CD æ–‡æ¡£
- [CI/CD è®¾ç½®](docs/CI_CD_SETUP.md) - Jenkins Pipeline é…ç½®
- [Docker Registry](docs/docker-registry.md) - é•œåƒä»“åº“é…ç½®æŒ‡å—
- [Dockerfile ä¼˜åŒ–](docs/dockerfile-optimizations.md) - é•œåƒä¼˜åŒ–æŠ€å·§

---

## è´¡çŒ®

æ¬¢è¿è´¡çŒ®ï¼è¯·éµå¾ªä»¥ä¸‹æ­¥éª¤ï¼š

### è´¡çŒ®æµç¨‹

1. **Fork æœ¬ä»“åº“**
   ```bash
   # åœ¨ GitHub ä¸Šç‚¹å‡» Fork æŒ‰é’®
   ```

2. **å…‹éš†ä½ çš„ Fork**
   ```bash
   git clone https://github.com/YOUR_USERNAME/docker-ecom-coursework.git
   cd docker-ecom-coursework
   ```

3. **åˆ›å»ºåŠŸèƒ½åˆ†æ”¯**
   ```bash
   git checkout -b feature/amazing-feature
   ```

4. **è¿›è¡Œä¿®æ”¹å¹¶æäº¤**
   ```bash
   git add .
   git commit -m 'feat: add amazing feature'
   ```

5. **æ¨é€åˆ°ä½ çš„ Fork**
   ```bash
   git push origin feature/amazing-feature
   ```

6. **åˆ›å»º Pull Request**
   - åœ¨ GitHub ä¸Šæ‰“å¼€ä½ çš„ Fork
   - ç‚¹å‡» "New Pull Request"
   - å¡«å†™ PR æè¿°
   - ç­‰å¾… Review

### æäº¤æ¶ˆæ¯è§„èŒƒ

éµå¾ª [Conventional Commits](https://www.conventionalcommits.org/) è§„èŒƒï¼š

```
<type>(<scope>): <subject>

<body>

<footer>
```

#### ç±»å‹ (Type)

- `feat`: æ–°åŠŸèƒ½
- `fix`: Bug ä¿®å¤
- `docs`: æ–‡æ¡£æ›´æ–°
- `style`: ä»£ç æ ¼å¼ï¼ˆä¸å½±å“åŠŸèƒ½ï¼‰
- `refactor`: é‡æ„ï¼ˆä¸æ˜¯æ–°åŠŸèƒ½ä¹Ÿä¸æ˜¯ä¿®å¤ï¼‰
- `perf`: æ€§èƒ½ä¼˜åŒ–
- `test`: æµ‹è¯•ç›¸å…³
- `chore`: æ„å»ºè¿‡ç¨‹æˆ–è¾…åŠ©å·¥å…·çš„å˜åŠ¨

#### ç¤ºä¾‹

```bash
# æ–°åŠŸèƒ½
git commit -m "feat(backend): add product search API"

# Bug ä¿®å¤
git commit -m "fix(frontend): resolve product image loading issue"

# æ–‡æ¡£æ›´æ–°
git commit -m "docs(readme): update deployment instructions"

# é‡æ„
git commit -m "refactor(service): optimize database query performance"
```

### ä»£ç è§„èŒƒ

#### Java ä»£ç 

- éµå¾ª [Google Java Style Guide](https://google.github.io/styleguide/javaguide.html)
- ä½¿ç”¨ 4 ç©ºæ ¼ç¼©è¿›
- ç±»åä½¿ç”¨ PascalCase
- æ–¹æ³•åä½¿ç”¨ camelCase
- å¸¸é‡ä½¿ç”¨ UPPER_SNAKE_CASE

#### JavaScript ä»£ç 

- ä½¿ç”¨ 2 ç©ºæ ¼ç¼©è¿›
- ä½¿ç”¨å•å¼•å·
- æ·»åŠ é€‚å½“çš„æ³¨é‡Š

#### Dockerfile

- ä½¿ç”¨å¤šé˜¶æ®µæ„å»º
- ä¼˜åŒ–å±‚ç¼“å­˜
- æ·»åŠ å¥åº·æ£€æŸ¥
- ä½¿ç”¨é root ç”¨æˆ·

### æµ‹è¯•è¦æ±‚

æäº¤ PR å‰è¯·ç¡®ä¿ï¼š

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
cd backend
mvn test

# æ£€æŸ¥ä»£ç è¦†ç›–ç‡ï¼ˆåº” â‰¥ 80%ï¼‰
mvn jacoco:report

# æ„å»º Docker é•œåƒ
docker build -t test-backend ./backend
docker build -t test-frontend ./frontend
```

### æ–‡æ¡£è¦æ±‚

- æ–°åŠŸèƒ½éœ€è¦æ›´æ–°ç›¸å…³æ–‡æ¡£
- API å˜æ›´éœ€è¦æ›´æ–° API æ–‡æ¡£
- é…ç½®å˜æ›´éœ€è¦æ›´æ–°éƒ¨ç½²æŒ‡å—

---

## è®¸å¯è¯

æœ¬é¡¹ç›®ç”¨äºæ•™è‚²å’Œæ¼”ç¤ºç›®çš„ã€‚

**ä½¿ç”¨é™åˆ¶**:
- âœ… å­¦ä¹ å’Œç ”ç©¶
- âœ… æ•™å­¦æ¼”ç¤º
- âœ… ä¸ªäººé¡¹ç›®
- âŒ å•†ä¸šç”¨é€”ï¼ˆæœªç»è®¸å¯ï¼‰

---

## è‡´è°¢

### æŠ€æœ¯æ ˆ

æ„Ÿè°¢ä»¥ä¸‹å¼€æºé¡¹ç›®ï¼š

- [Spring Boot](https://spring.io/projects/spring-boot) - ä¼ä¸šçº§ Java æ¡†æ¶
- [Docker](https://www.docker.com/) - å®¹å™¨åŒ–å¹³å°
- [Kubernetes](https://kubernetes.io/) - å®¹å™¨ç¼–æ’ç³»ç»Ÿ
- [Jenkins](https://www.jenkins.io/) - CI/CD è‡ªåŠ¨åŒ–
- [Prometheus](https://prometheus.io/) - ç›‘æ§ç³»ç»Ÿ
- [Grafana](https://grafana.com/) - å¯è§†åŒ–å¹³å°
- [MySQL](https://www.mysql.com/) - å…³ç³»å‹æ•°æ®åº“
- [Nginx](https://nginx.org/) - Web æœåŠ¡å™¨

### å‚è€ƒèµ„æ–™

- [Docker å®˜æ–¹æ–‡æ¡£](https://docs.docker.com/)
- [Kubernetes å®˜æ–¹æ–‡æ¡£](https://kubernetes.io/docs/)
- [Spring Boot å®˜æ–¹æ–‡æ¡£](https://docs.spring.io/spring-boot/docs/current/reference/html/)
- [Jenkins å®˜æ–¹æ–‡æ¡£](https://www.jenkins.io/doc/)

---

## è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š

- ğŸ“§ **Email**: æäº¤ Issue
- ğŸ’¬ **GitHub Issues**: [æäº¤é—®é¢˜](https://github.com/pahhcn/docker-ecom-coursework/issues)
- ğŸ“ **Pull Requests**: [è´¡çŒ®ä»£ç ](https://github.com/pahhcn/docker-ecom-coursework/pulls)

---

## é¡¹ç›®ç»Ÿè®¡

<div align="center">

![GitHub stars](https://img.shields.io/github/stars/pahhcn/docker-ecom-coursework?style=social)
![GitHub forks](https://img.shields.io/github/forks/pahhcn/docker-ecom-coursework?style=social)
![GitHub issues](https://img.shields.io/github/issues/pahhcn/docker-ecom-coursework)
![GitHub pull requests](https://img.shields.io/github/issues-pr/pahhcn/docker-ecom-coursework)

</div>

---

## æ›´æ–°æ—¥å¿—

### v1.0.0 (2025-12-28)

#### âœ¨ æ–°åŠŸèƒ½
- âœ… å®Œæ•´çš„ä¸‰å±‚æ¶æ„å®ç°
- âœ… Docker å¤šé˜¶æ®µæ„å»ºä¼˜åŒ–
- âœ… Kubernetes è“ç»¿éƒ¨ç½²
- âœ… Jenkins CI/CD è‡ªåŠ¨åŒ–æµæ°´çº¿
- âœ… Prometheus + Grafana ç›‘æ§ç³»ç»Ÿ
- âœ… å®Œæ•´çš„æµ‹è¯•ä½“ç³»ï¼ˆå•å…ƒæµ‹è¯• + å±æ€§æµ‹è¯•ï¼‰
- âœ… JaCoCo ä»£ç è¦†ç›–ç‡æŠ¥å‘Š

#### ğŸ“Š æ€§èƒ½æŒ‡æ ‡
- åç«¯é•œåƒå¤§å°: < 200MB
- å‰ç«¯é•œåƒå¤§å°: < 40MB
- ä»£ç è¦†ç›–ç‡: 85%
- æ„å»ºæ—¶é—´: ~5 åˆ†é’Ÿ
- éƒ¨ç½²æ—¶é—´: ~2 åˆ†é’Ÿ

#### ğŸ“š æ–‡æ¡£
- âœ… å®Œæ•´çš„ä¸­æ–‡æ–‡æ¡£
- âœ… API æ¥å£æ–‡æ¡£
- âœ… éƒ¨ç½²è¿è¡ŒæŒ‡å—
- âœ… æ•…éšœæ’æŸ¥æŒ‡å—
- âœ… Dockerfile ç¼–å†™æŒ‡å—
- âœ… ç›‘æ§ç³»ç»Ÿé…ç½®æŒ‡å—

---

<div align="center">

**â­ å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸€ä¸ª Starï¼â­**

Made with â¤ï¸ for DevOps Learning

**ç‰ˆæœ¬**: 1.0.0  
**æœ€åæ›´æ–°**: 2025-12-28

[è¿”å›é¡¶éƒ¨](#docker-ç”µå•†æ•°æ®ç®¡ç†ç³»ç»Ÿ)

</div>
